<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Water Heating &amp; Stratification | GLM Workbook</title>
  <meta name="description" content="The Online GLM Workbook" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Water Heating &amp; Stratification | GLM Workbook" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="The Online GLM Workbook" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Water Heating &amp; Stratification | GLM Workbook" />
  
  <meta name="twitter:description" content="The Online GLM Workbook" />
  

<meta name="author" content="Matt Hipsey, Dan Paraska, Peisheng Huang, Casper Boon, Giles Knight" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="WaterBalance.html"/>
<link rel="next" href="updating-initial-height-conditions.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="https://hypothes.is/embed.js" async></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><b>GLM Workbook</b></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="GettingStarted.html"><a href="GettingStarted.html"><i class="fa fa-check"></i>Getting Started</a><ul>
<li class="chapter" data-level="" data-path="GettingStarted.html"><a href="GettingStarted.html#glm-documentation"><i class="fa fa-check"></i>GLM Documentation</a></li>
<li class="chapter" data-level="" data-path="GettingStarted.html"><a href="GettingStarted.html#tools-youll-need"><i class="fa fa-check"></i>Tools You’ll Need</a><ul>
<li class="chapter" data-level="" data-path="GettingStarted.html"><a href="GettingStarted.html#text-editor"><i class="fa fa-check"></i>Text Editor</a></li>
<li class="chapter" data-level="" data-path="GettingStarted.html"><a href="GettingStarted.html#excel"><i class="fa fa-check"></i>Excel</a></li>
<li class="chapter" data-level="" data-path="GettingStarted.html"><a href="GettingStarted.html#r"><i class="fa fa-check"></i>R</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="GettingStarted.html"><a href="GettingStarted.html#unzipping-files"><i class="fa fa-check"></i>Unzipping files</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="glm-file-structure.html"><a href="glm-file-structure.html"><i class="fa fa-check"></i>GLM File Structure</a><ul>
<li class="chapter" data-level="" data-path="glm-file-structure.html"><a href="glm-file-structure.html#glm-input-files"><i class="fa fa-check"></i>GLM input files</a><ul>
<li class="chapter" data-level="" data-path="glm-file-structure.html"><a href="glm-file-structure.html#glm-configuration-file-glm3.nml"><i class="fa fa-check"></i>GLM configuration file: <code>glm3.nml</code></a></li>
<li class="chapter" data-level="" data-path="glm-file-structure.html"><a href="glm-file-structure.html#glm-plot-window-file-plots.nml"><i class="fa fa-check"></i>GLM plot window file: <code>plots.nml</code></a></li>
<li class="chapter" data-level="" data-path="glm-file-structure.html"><a href="glm-file-structure.html#boundary-files"><i class="fa fa-check"></i>Boundary files</a></li>
<li class="chapter" data-level="" data-path="glm-file-structure.html"><a href="glm-file-structure.html#aed-water-quality-model-files"><i class="fa fa-check"></i>AED water quality model files</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="glm-file-structure.html"><a href="glm-file-structure.html#glm-output-files"><i class="fa fa-check"></i>GLM output files</a><ul>
<li class="chapter" data-level="" data-path="glm-file-structure.html"><a href="glm-file-structure.html#output-netcdf"><i class="fa fa-check"></i>Output Netcdf</a></li>
<li class="chapter" data-level="" data-path="glm-file-structure.html"><a href="glm-file-structure.html#general-lake-.csv"><i class="fa fa-check"></i>General lake .csv</a></li>
<li class="chapter" data-level="" data-path="glm-file-structure.html"><a href="glm-file-structure.html#depth-specific-.csv"><i class="fa fa-check"></i>Depth-specific .csv</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="running-glm.html"><a href="running-glm.html"><i class="fa fa-check"></i>Running GLM</a></li>
<li class="part"><span><b>I Exercises</b></span></li>
<li class="chapter" data-level="1" data-path="WaterBalance.html"><a href="WaterBalance.html"><i class="fa fa-check"></i><b>1</b> Water Level &amp; Balance</a></li>
<li class="chapter" data-level="2" data-path="WaterHeatingAndStratification.html"><a href="WaterHeatingAndStratification.html"><i class="fa fa-check"></i><b>2</b> Water Heating &amp; Stratification</a></li>
<li class="chapter" data-level="3" data-path="updating-initial-height-conditions.html"><a href="updating-initial-height-conditions.html"><i class="fa fa-check"></i><b>3</b> Updating Initial Height Conditions</a></li>
<li class="chapter" data-level="4" data-path="error-assessment.html"><a href="error-assessment.html"><i class="fa fa-check"></i><b>4</b> Error Assessment</a><ul>
<li class="chapter" data-level="" data-path="error-assessment.html"><a href="error-assessment.html#mean-absolute-error-mae"><i class="fa fa-check"></i>Mean Absolute Error (MAE)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="adding-water-quality-models.html"><a href="adding-water-quality-models.html"><i class="fa fa-check"></i><b>5</b> Adding Water Quality Models</a></li>
<li class="chapter" data-level="6" data-path="sensitivity-index-si.html"><a href="sensitivity-index-si.html"><i class="fa fa-check"></i><b>6</b> Sensitivity Index (SI)</a></li>
<li class="chapter" data-level="7" data-path="warming-air-scenario.html"><a href="warming-air-scenario.html"><i class="fa fa-check"></i><b>7</b> Warming Air Scenario</a></li>
<li class="chapter" data-level="8" data-path="changing-morphometry.html"><a href="changing-morphometry.html"><i class="fa fa-check"></i><b>8</b> Changing Morphometry</a></li>
<li class="part"><span><b>II Case Studies</b></span></li>
<li class="chapter" data-level="" data-path="warm-lake.html"><a href="warm-lake.html"><i class="fa fa-check"></i>Warm Lake</a><ul>
<li class="chapter" data-level="" data-path="warm-lake.html"><a href="warm-lake.html#lake-stratification"><i class="fa fa-check"></i>Lake Stratification</a></li>
<li class="chapter" data-level="" data-path="warm-lake.html"><a href="warm-lake.html#the-ecosystem-model"><i class="fa fa-check"></i>The Ecosystem Model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cool-lake.html"><a href="cool-lake.html"><i class="fa fa-check"></i>Cool Lake</a></li>
<li class="chapter" data-level="" data-path="tropical-reservoir.html"><a href="tropical-reservoir.html"><i class="fa fa-check"></i>Tropical Reservoir</a></li>
<li class="part"><span><b>III Old Stuff</b></span></li>
<li class="chapter" data-level="" data-path="processing-outputs.html"><a href="processing-outputs.html"><i class="fa fa-check"></i>Processing Outputs - OLD</a><ul>
<li class="chapter" data-level="" data-path="processing-outputs.html"><a href="processing-outputs.html#visualising-results"><i class="fa fa-check"></i>Visualising Results</a><ul>
<li class="chapter" data-level="" data-path="processing-outputs.html"><a href="processing-outputs.html#excel-1"><i class="fa fa-check"></i>Excel</a></li>
<li class="chapter" data-level="" data-path="processing-outputs.html"><a href="processing-outputs.html#r-1"><i class="fa fa-check"></i>R</a></li>
<li class="chapter" data-level="" data-path="WaterBalance.html"><a href="WaterBalance.html#WaterBalance"><i class="fa fa-check"></i>Water balance</a></li>
<li class="chapter" data-level="" data-path="processing-outputs.html"><a href="processing-outputs.html#heat-balance"><i class="fa fa-check"></i>Heat balance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="case-study-kinneret---old.html"><a href="case-study-kinneret---old.html"><i class="fa fa-check"></i>Case Study: Kinneret - OLD</a><ul>
<li class="chapter" data-level="" data-path="case-study-kinneret---old.html"><a href="case-study-kinneret---old.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="case-study-kinneret---old.html"><a href="case-study-kinneret---old.html#exercises"><i class="fa fa-check"></i>Exercises</a></li>
<li class="chapter" data-level="" data-path="case-study-kinneret---old.html"><a href="case-study-kinneret---old.html#error-assessment-1"><i class="fa fa-check"></i>Error Assessment</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="case-study-darwin---old.html"><a href="case-study-darwin---old.html"><i class="fa fa-check"></i>Case Study: Darwin - OLD</a><ul>
<li class="chapter" data-level="" data-path="case-study-darwin---old.html"><a href="case-study-darwin---old.html#about-1"><i class="fa fa-check"></i>About</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="other-simulations---old.html"><a href="other-simulations---old.html"><i class="fa fa-check"></i>Other Simulations - OLD</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GLM Workbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="WaterHeatingAndStratification" class="section level1 hasAnchor">
<h1><span class="header-section-number">2</span> Water Heating &amp; Stratification<a href="WaterHeatingAndStratification.html#WaterHeatingAndStratification" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The energy balance is the sum of all energy entering and leaving the lake (equation <a href="WaterHeatingAndStratification.html#eq:enbal-1">(2.1)</a>).</p>
<span class="math display" id="eq:enbal-1">\[\begin{eqnarray}
\frac{\Delta Energy}{\Delta time} = + φSW  + φH + φLW - φE
\tag{2.1}
\end{eqnarray}\]</span>
<p>where <span class="math inline">\(φSW\)</span> is the flux of shortwave radiation into the lake. In the <code>lake.csv</code> file, this appears as <code>Daily Qsw</code>. <span class="math inline">\(φH\)</span> is the sensible heat flux (<code>Daily Qh</code>). <span class="math inline">\(φLW\)</span> is the sum of longwave radiation into and out of the lake (<code>Daily Qlw</code>). <span class="math inline">\(φE\)</span> is the latent heat flux (<code>Daily Qe</code>).</p>
<center>
<img src="images/Exercises/HeatBalance-12.png" width="50%" />
</center>
<center>
<img src="images/Exercises/StratificationMovie.gif" width="50%" />
</center>
<p>Copy the data from <code>lake.csv</code> to a new spreadsheet. Plot the surface heat fluxes and the total energy balance over time.</p>
<p>A lake is ‘stratified’ if it has a large difference between the top and bottom for a variable such as temperature or salinity. A seasonal weather pattern may break the stratification. Use the GLM plotting window to examine whether you lake is stratified. Do you see any seasonal patterns in the temperature differences between the top and the bottom? Is this reflected in any variables other than temperature?</p>
<p>Go to the <code>&amp;output</code> (not <code>&amp;outflow</code>!) section of <code>glm3.nml</code> and customize the configuration to make two output files, one at 5 m from the bottom (ie. in the lake hypolimnion) and one at 35 m from the bottom (i.e. in the lake epilimnion). Use the parameter <code>csv_point_at</code> to set the depths, from the bottom, at which the model will write .csv files. This creates two <code>.csv</code> files (<code>WQ_5.csv</code> and <code>WQ_35.csv</code>) with conditions at these water depths.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode fortran"><code class="sourceCode fortran"><a class="sourceLine" id="cb2-1" title="1"><span class="co">!-------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">! format for output and filename(s)</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">!-------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">&amp;</span>output</a>
<a class="sourceLine" id="cb2-5" title="5">   out_dir <span class="kw">=</span> <span class="st">&#39;output&#39;</span></a>
<a class="sourceLine" id="cb2-6" title="6">   out_fn  <span class="kw">=</span> <span class="st">&#39;output&#39;</span></a>
<a class="sourceLine" id="cb2-7" title="7">   nsave <span class="kw">=</span> <span class="dv">6</span>  <span class="co">!This will output every 6 hours</span></a>
<a class="sourceLine" id="cb2-8" title="8">   <span class="co">! General summary file</span></a>
<a class="sourceLine" id="cb2-9" title="9">   csv_lake_fname <span class="kw">=</span> <span class="st">&#39;lake&#39;</span></a>
<a class="sourceLine" id="cb2-10" title="10">   <span class="co">! Depth specific outputs</span></a>
<a class="sourceLine" id="cb2-11" title="11">   csv_point_nlevs <span class="kw">=</span> <span class="dv">2</span> </a>
<a class="sourceLine" id="cb2-12" title="12">   csv_point_fname <span class="kw">=</span> <span class="st">&#39;WQ_&#39;</span></a>
<a class="sourceLine" id="cb2-13" title="13">   csv_point_at <span class="kw">=</span> <span class="fl">5.</span>,<span class="fl">35.</span></a>
<a class="sourceLine" id="cb2-14" title="14">   csv_point_nvars <span class="kw">=</span> <span class="dv">4</span></a>
<a class="sourceLine" id="cb2-15" title="15">   csv_point_vars <span class="kw">=</span> <span class="st">&#39;temp&#39;</span>,<span class="st">&#39;salt&#39;</span>,<span class="st">&#39;PHS_frp&#39;</span>,<span class="st">&#39;NIT_amm&#39;</span></a>
<a class="sourceLine" id="cb2-16" title="16"><span class="kw">/</span></a></code></pre></div>
<p>Save the <code>glm3.nml</code> and run the model again.</p>
<p>Find the new output .csv files in the <code>output</code> folder. Copy the data to a new Excel spreadsheet. Calculate the temperature difference between the top and the bottom. Identify the periods where the lake is stratified and mixed.</p>

<div class="rmdtip2">
If an output file is open in Excel, the GLM program cannot overwrite the file. Close the .csv or save it with a different file name before running the model again.
</div>


</div>
            </section>

          </div>
        </div>
      </div>
<a href="WaterBalance.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="updating-initial-height-conditions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["GLM Module Resources.zip", "GLM Module Resources"]],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

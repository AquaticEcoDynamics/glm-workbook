[
["index.html", "GLM Workbook Introduction", " GLM Workbook Matt Hipsey, Giles Knight, Casper Boon, Dan Paraska Last updated: 2020-09-24 Introduction "],
["GettingStarted.html", "Getting Started", " Getting Started Tools You’ll Need Excel Excel is available on all computer laboratory PC’s and can be freely downloaded to personal devices here. You should already feel confident using Excel from your previous units, however if you need further guidance please visit UWA’s LinkedIn Learning resources. R To get started with R, first download the base R system onto your computer. By itself, this provides a rudimentary console for interacting with the R programming language. For a more user-friendly experience, download the R Studio integrated development environment (IDE). R can be downloaded here R Studio can be downloaded here Terminology File types In this unit you will largely be dealing with two kinds of ‘R files’: R script files (e.g. Equations.R) and, R project files (e.g. Module2Biogeochem.Rproj) R scripts are the raw instructions that tell the R programming language what to do. Meanwhile, an R Project file simply creates an independent workplace environment for you to interact with and manage your scripts. It’s wise to create a new R Project file whenever you start working on a new project. Functions and packages Just like Excel, you can interact with your data using a variety of functions in R. Functions are the tools you use to get the job done. For example, the plot() function can be used to create graphs. R is an open source programming language, meaning anyone can create their own functions and bundle them up in a collection known as a package. Comments All programming languages allow the user to write comments on their code to assist in readability and structure. In R, a comment is defined as a line beginning with a #. Any characters written after the # are ignored by R and not executed. It’s good practice to get into the habit of commenting your R code as it will likely save you (or someone else!) a lot of time later down the track. # This is a comment! # Create a graph using the plot() function plot(my_data,variable1,col=&quot;red&quot;,ylab=&quot;My y-axis label&quot;) # Plot other variables onto the graph using the points() function points(my_data,variable2,col=&quot;blue&quot;) points(my_data,variable3,col=&quot;green&quot;) points(my_data,variable4,col=&quot;purple&quot;) To comment multiple lines of code at once in R Studio, pressCommand + Shift + Con MacOS orControl + Shift + Con Windows Further R resources Read the Introduction to R and Statistics book for a more detailed coverage on the core data visualisation and statistics capabilities in R Access UWA’s LinkedIn Learning portal the learn more about the basics of R Refer to some handy R cheatsheets R Studio cheatsheet ggplot2 data visualisation cheatsheet Unzipping files Many of the module resources found in this workbook are downloaded as ‘zipped’ (i.e. compressed) files. ‘Unzipping’ (i.e. extracting) these files is simple. On MacOS, simply double click the ‘zipped’ file: On Windows, click ‘Extract All’ and follow the prompt: "],
["C02-1.html", "Module 1: Getting Started with GLM", " Module 1: Getting Started with GLM Module Resources Download the GLM files for this module by clicking the download button in the tool bar . Setting up GLM Running GLM on MacOS Open the Terminal application on your Mac Use the cd (change directory) command to navigate to the Kinneret97 folder In Finder, go to the macGLM folder and right-click on the glm app, select Show Package Contents Enter the Contents folder then the MacOS folder, and locate the glm executable file Back in terminal, enter the file path for this executable file - you can do this by dragging/dropping the file into the terminal Leave a space after the file path and type --xdisp Press Enter and the model will open Your Mac may block opening GLM the first time you run it. If this occurs, go to your Security options inside System Preferences and click ‘Open Anyway’. Running GLM on Windows On Windows, the model can be run using a batch-file glm.bat, which you can double click from in the Kinneret97 directory. The .bat file calls the GLM model from the current working directory. If the model is not opening make sure you’re not working in a network directory (e.g. OneDrive) and the file path to the glm.bat file has zero spaces in it. Anatomy of a Simulation Once the model has run, you can inspect the results. There are three ways to look at the output: Via the time-depth contour plots that appear during the run (configured via plots.nml) Further information on the daily water and energy balance is in the output file lake.csv Time series values of selected state variables (e.g. temperature, salinity, etc…) can be requested for a specific depth (depth above bottom) – this is setup in &amp;outputs (eg. WQ_5.csv) Exercise: Lake-scale Water &amp; Heat Balance The simulation in the Kinneret97 directory is an example 40m deep, monomictic lake that is used to supply drinking water and support an active fishery. Before running the model, open the file glm3.nml in a text editor and inspect the model setup etc. This file is the main configuration file that drives the model. The file glm3.nml has several key sections in it related to the model domain and parameters, the sources of boundary condition data, and details of outputs. Scan the parameters, e.g. number of layers, light extinction coefficient, mixing coefficient etc. Draw a schematic picture of the lake, the relevant boundary conditions (both related to water fluxes and energy fluxes). Identify and open the boundary condition input files - these are csv files containing time-series of meteorological information, and inflow and outflow volumes. These files can be opened in Excel or a text-editor. Find where these files are called from within glm3.nml. Plot the lake water balance – volume, water level and fluxes including inflows, outflows, rainfall and evaporation (refer to columns in lake.csv, and copy the appropriate data into your own excel spreadsheet). Figure 1: Schematic diagram of water balance components. Plot the surface heat fluxes such as shortwave, longwave, sensible heat latent heat (refer to columns in lake.csv). Figure 2: Schematic diagram of surface heat fluxes impacting lake water temperature. For a description of the heat flux terms refer to the GLM paper "],
["C03-1.html", "Module 2: Configuring Model Parameters", " Module 2: Configuring Model Parameters Getting Familiar with the .nml To configure the model, open the glm3.nml file in the Kinneret97 directory with a text editor. A chunk of this .nml file is shown below. For example, if you wanted to change the maximum number of lake layers the model simulates, you would change max_layers = 500. The easiest way to edit the glm3.nml file is with the Atom text editor. You can download it here. !------------------------------------------------------------------------------! ! ! ! .----------------. .----------------. .----------------. ! ! | .--------------. || .--------------. || .--------------. | ! ! | | ______ | || | _____ | || | ____ ____ | | ! ! | | .&#39; ___ | | || | |_ _| | || ||_ \\ / _|| | ! ! | | / .&#39; \\_| | || | | | | || | | \\/ | | | ! ! | | | | ____ | || | | | _ | || | | |\\ /| | | | ! ! | | \\ `.___] _| | || | _| |__/ | | || | _| |_\\/_| |_ | | ! ! | | `._____.&#39; | || | |________| | || ||_____||_____|| | ! ! | | | || | | || | | | ! ! | &#39;--------------&#39; || &#39;--------------&#39; || &#39;--------------&#39; | ! ! &#39;----------------&#39; &#39;----------------&#39; &#39;----------------&#39; ! ! ! !------------------------------------------------------------------------------- !------------------------------------------------------------------------------- ! general model setup !------------------------------------------------------------------------------- &amp;glm_setup sim_name = &#39;Example Kinneret GLM Simulation&#39; max_layers = 500 min_layer_vol = 0.025 min_layer_thick = 0.15 max_layer_thick = 1.50 density_model = 1 / Exercise: Adding Output Points Go to the &amp;output section of glm3.nml and customize the configuration to make two output files, one at 5m from the bottom (ie. in the lake hypolimnion) and one at 35m from the bottom (ie. in the lake epilimnion). This create two .csv files (WQ_5.csv and WQ_35.csv) with conditions at these water depths. Plot the temperate of the two layers in excel. Identify the periods where the lake is stratified and mixed. !------------------------------------------------------------------------------- ! format for output and filename(s) !------------------------------------------------------------------------------- &amp;output out_dir = &#39;output&#39; out_fn = &#39;output&#39; nsave = 6 !This will output every 6 hours ! General summary file csv_lake_fname = &#39;lake&#39; ! Depth specific outputs csv_point_nlevs = 2 csv_point_fname = &#39;WQ_&#39; csv_point_at = 5.,35. csv_point_nvars = 4 csv_point_vars = &#39;temp&#39;,&#39;salt&#39;,&#39;PHS_frp&#39;,&#39;NIT_amm&#39; / Assess how the degree of stratification changes as the initial water level of the lake is reduced by 20m. To do this change the initial starting lake depth and profile details in glm3.nml. You will need to update the output depth of your surface output file. For future activities make sure you change back to 43m. "],
["C04-1.html", "Module 3: The Ecosystem Model", " Module 3: The Ecosystem Model The Kinneret97 model simulation above has the ecological model aed2 enabled. It has been pre- configured to run the customizable AED modules. These are separate models, but have been set up to run side by side. They are configured using the text file aed2.nml. The above simulation was only plotting temperature and salinity and these plots were configured in plots.nml. Open plots.nml to see how you can customise the graphs. There are many other variables we may be interested in plotting when we run the watter quality model such as oxygen, nutrients, and algae. A pre-configured file called plots_aed2.nml has been created. To use this file, rename it to plots.nml (you’ll first need to rename the existing plots.nml) and run the model. You should now see more outputs for the lake simulation. In plots.nml the required variables are all listed, make sure the number of plots is high enough to include them all. Table 1: Water quality variables and their descriptions. Description Variable Name Passive tracer TRC_tr1 Water age TRC_age Suspended solids NCS_ss1 Dissolved oxygen OXY_oxy Dissolved inorganic carbon CAR_dic pH CAR_pH Methane (dissolved) CAR_ch4 Methane (bubbles) CAR_ch4_bub Reactive Silica SIL_rsi Ammonium NIT_amm Nitrate/Nitrite NIT_nit Phosphate PHS_frp Particulate inorganic phosphorus PHS_frp_ads Dissolved organic carbon OGM_doc Particualte organic carbon OGM_poc Dissolved organic nitrogen OGM_don Dissolved organic nitrogen OGM_pon Particualte organic phosphorus OGM_dop Dissolved organic phsophorus OGM_pop Green algae PHY_green Green algae PHY_green_IN Green algae PHY_green_IP Diatoms PHY_diatom Diatoms PHY_diatom_IN Diatoms PHY_diatom_IP Cyrptophytes PHY_crypto Cyrptophytes PHY_crypto_IN Cyrptophytes PHY_crypto_IP Zooplankton ZOO_zoo01 Let’s also now add water quality variables to the specific depth output files (i.e. WQ_5.csv). To do so we must edit the output section of the glm3.nml file, by adding the variables as extra columns to the .csv file that were configured above. If they are there already, make sure that the number of variables is high enough to include them all. ol > li > ol > li {list-style-type:lower-alpha} As an example to output water quality variables, let’s plot all the nitrogen variables. Change csv_point_vars to include NIT_amm, NIT_nit, OGM_don, OMG_pon, PHY_green_IN - these are all the variables that contribute to the total nitrogen (TN) pool. Now re-run the model (e.g. Windows users double clicking glm.bat again). Once it’s run open WQ_35.csv to see these new variables and create a stacked area plot to show how the different variables contribute to TN. Create a well formatted, interesting graph of variables of your choice (for example, you may like to consider all of the phytoplankton groups or create sums of these to generate a NPZD model) to see how they interact and change over time. If any variables are much bigger or smaller than the others, then use two y-axes or multiple plots. How would these concentrations change if the air temperature increased by 2°C? (You will need to edit the met_hourly.csv file). Make sure to save with correct date format, taking note these met measurements are recorded hourly, so YYYY-MM-DD hh:mm. A pre-made version of this file can be found in bcs which is called met_1997_2004_airT2.csv. To use this file, update meteo_fl = 'bcs/met_1997_2004.csv' in the &amp;meteorology section of glm3.nml. !------------------------------------------------------------------------------- ! meteorology !------------------------------------------------------------------------------- &amp;meteorology met_sw = .true. lw_type = &#39;LW_IN&#39; rain_sw = .false. atm_stab = 0 fetch_mode = 0 !rad_mode = 1 albedo_mode = 1 cloud_mode = 4 !-- BC file details subdaily = .true. meteo_fl = &#39;bcs/met_1997_2004.csv&#39; &lt;------- Update this! wind_factor = 0.9 lw_factor = 1.0 lw_offset = 0.0 !-- Parameters ce = 0.0013 ch = 0.0013 cd = 0.0013 !catchrain = .true. !rain_threshold = 0.001 !runoff_coef = 0.0 / What happens if we change the water clarity? Increase and decrease from the original value to see the response You must change the light extinction coefficient Kw (range 0-1) in the glm3.nml file. "],
["C05-1.html", "Module 4: Assessing Error &amp; Sensitivity", " Module 4: Assessing Error &amp; Sensitivity Calculate the mean absolute error in the simulation using the observed temperature data (ObservedTempData.xlsx from the data folder in Kinneret97) and the simulated temperature data (the simulated temperature data is from the surface layer in lake.csv). \\[\\begin{equation} MAE = \\frac{\\sum_{i}\\left | T_{i}^{sim}-T_{i}^{obs} \\right |}{n} \\tag{1} \\end{equation}\\] ol > li > ol > li {list-style-type:lower-alpha} Calculate the sensitivity of the modelled temperature to changes in water clarity (the light extinction coefficient, \\(K_w\\)) and wind speed (wind_factor). These can be found in glm3.nml. Try increasing and decreasing the default parameter value by 0.2 and see how much the output changes. \\[\\begin{equation} SI = \\frac{(Output_{new}-Output_{original})/Output_{original}}{(Parameter_{new}-Parameter_{original})/Parameter_{original}} \\tag{2} \\end{equation}\\] Assess how sensitive the temperature and phytoplankton biomass is to water clarity: GLM results Water clarity Decrease 0.37 Water clarity Original 0.57 Water clarity Increase 0.77 Average WQ_35 temperature Average WQ_35 phytoplankton (green, crypto, diatom) biomass Assess how sensitive the temperature and phytoplankton biomass is to wind speed: GLM results Wind Speed Decrease 0.6 Wind Speed Original 0.9 Wind Speed Increase 1.2 Average WQ_35 temperature Average WQ_35 phytoplankton (green, crypto, diatom) biomass "],
["references.html", "References", " References "]
]

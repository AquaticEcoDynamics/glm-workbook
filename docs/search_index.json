[["index.html", "GLM Workbook Introduction", " GLM Workbook Matt Hipsey, Dan Paraska, Peisheng Huang, Casper Boon, Giles Knight Last updated: 2022-09-12 Introduction "],["GettingStarted.html", "Getting Started GLM Documentation Tools You’ll Need Unzipping files", " Getting Started GLM Documentation For GLM technical documentation, visit the glm-aed GitHub Repository wiki. For a detailed scientific overview of GLM, refer to Hipsey et al. (2019)’s paper available here. Tools You’ll Need Text Editor A text editor is required to edit GLM’s .nml configuration files. Simple text editors like TextEdit on MacOS or Wordpad on Windows can be used however more extensible editors like Visual Studio Code or Atom are recommended. To edit the .nml file, simply right click on the file and open it in your preferred text editor. Changes to the file must be saved before running GLM. Excel GLM can read and write data in CSV format. Excel can be used to edit these files (e.g. time series meteorological input data) or plotting outputs. R Similarly to Excel, R can be used to manipulate and visualise GLM’s inputted/outputted dated. R can be downloaded here R Studio can be downloaded here Unzipping files The GLM model and case study simulations featured in this workbook are distributed as a zipped file. Extracting these files will depend on your operating system. On MacOS, simply double click the ‘zipped’ file: On Windows, click ‘Extract All’ and follow the prompt: References "],["glm-file-structure.html", "GLM File Structure 0.1 GLM input files 0.2 GLM output files 0.3 AED water quality model files", " GLM File Structure 0.1 GLM input files 0.1.1 GLM configuration file: glm3.nml A GLM model simulation is controlled through the main configuration file : glm3.nml. The key elements of this file are depicted as ‘blocks’ and each block of configuration options and parameters is summarised in detail on this page. Each block is started with an ampersand &amp; and finished with a slash /. The blocks contain text that can be either - single parameters (with units) - listed parameters, for example, for every depth layer or every river inflow - listed variables, for example, variables to be read in or written to the output - file paths and file names - configuration switches (integers or logical values) Some key inputs for setting up a GLM simulation are listed below. &amp;wq_setup:wq_lib sets an external water quality model, for example, ‘aed’. &amp;wq_setup:wq_nml_file is the filepath and filename for an external water quality model namelist. &amp;glm_morphometry:H is a list of some of the heights of the lake. &amp;glm_morphometry:A is a list of some of the areas of the lake, at the same layers listed in H. &amp;time:timefmt is a switch for the time setup: either number of days (= 3) or start and stop days (= 2). &amp;time:start and stop are the dates to start and stop (timefmt = 2). &amp;time:num_days is the number of days for a simulation (timefmt = 3). &amp;output:csv_point_nlevs is the number of csv_point_at depths to use, as listed left to right. &amp;output:csv_point_at is a list of the depths (m) from the bottom at which an output csv file is written. &amp;output:csv_point_vars is a list of the simulated variables to write to the output csv. &amp;output:csv_point_nvars is the number of csv_point_vars to use, as listed left to right. TIP: if a csv_point_at depth is listed but it is greater than the initial depth of the lake, no initial value can be written and the model will not work. &amp;init_profiles:num_depths is the number (integer) of depths to set for the initial profile. &amp;init_profiles:the_depths are the depths (m) of the initial profiles, where other features are configured, from bottom to top. &amp;init_profiles:the_temps are the initial temperatures at the_depths. &amp;init_profiles:the_sals are the initial salinity at the_depths. &amp;inflow:num_inflows is a number (integer) of inflowing streams. &amp;inflow:inflow_fl is a list of the file names for the inflowing streams. &amp;inflow:inflow_vars is a list of variables to be taken from the inflow files. &amp;outflow:num_outlet is a number (integer) of outflowing streams. &amp;outflow:outflow_fl is a list of the file names for the outflowing streams. &amp;outflow:outflow_fl is a list of the file names for the outflowing streams. &amp;sediment:zone_heights is a list of the heights (m) of the sediment zones, from bottom to top. 0.1.2 GLM plot window file: plots.nml The plots.nml text file configures the automatic plot window that runs during the simulation. The x axis is time, the y axis is lake depth layer and the z axis (colour bar) is the scale of the variable, for example concentration. The user can configure the plot window using the following: - &amp;plots_window:width and height set the dimensions of the plotting window (mm). - &amp;plots:plot_width and plot_height set the dimensions of the individual plots (mm). - &amp;plots:title is a list of the titles displayed above each plot. - &amp;plots:vars is a list of the GLM or AED variables for each plot, in the same sequence as title. - &amp;plots:min_z and max_z set the minimum and maximum values for each of the variables, in the same sequence as title. 0.1.3 Boundary files Boundary .csv files can be found in the ‘inputs’ directory. The exact names and paths are listed in the glm3.nml block &amp;inflow, &amp;outflow and &amp;meteorology. 0.1.3.1 Inflow files The simulated lake may have streams or rivers flowing into it. If so, one time series boundary .csv file is used for each inflow stream. The rows of the csv are time steps and the columns are inflowing variables, such as flow volume, salinity and oxygen. The file names are listed in inflow_fl and the model will read them in from left to right according to the number set in num_inflows. 0.1.3.2 Outflow files In a similar way to the inflow files, the simulated lake may have streams or rivers flowing out of it. If so, one time series boundary .csv file is used for each outflow stream. The rows of the csv are time steps and the columns are outflowing variables, such as flow volume, salinity and oxygen. The file names are listed in outflow_fl and the model will read them in from left to right according to the number set in num_outlet. 0.1.3.3 Meteorological file One meteorological file sets conditions at the surface of the lake, i.e. the water-atmosphere boundary. It includes values such as air temperature, wind speed and light. The file is also a time-series boundary, with rows as time steps and columns as each boundary variable. It often has a name like ‘met.csv’. 0.2 GLM output files Once GLM is running, it will write its results to several different output files. 0.2.1 Output Netcdf The results of all variables at all time steps and depths are written to the netcdf file. This file may have a size of hundreds of MB or GB. The file can be accessed with Matlab or R packages that have been created to organize these large file types. 0.2.2 General lake csv One csv is written for each simulation. The file name is set with the parameter &amp;output: csv_lake_fname, for example ‘lake.csv’. This file contains values that apply to the whole lake, such as lake volume, lake level and surface temperature. Tip: if this file is open in a program such as Excel, the GLM program cannot overwrite the file. Close the .csv or save it with a different file name before running the model again. 0.2.3 Depth-specific .csv Profiles can be output at specified depths, using &amp;output: csv_point_fname and csv_point_at. For example, if csv_point_fname is ‘WQ’ and csv_point_at is 1, 5, 12, then the model will create files ‘WQ_1’, ‘WQ_5’ and ‘WQ_12’. The variables for this file are listed in the parameter csv_point_vars. This file can be used to access output data at one depth more easily than via the netcdf file. 0.3 AED water quality model files "],["running-glm.html", "Running GLM", " Running GLM Running GLM on MacOS Open the Terminal application on your Mac Use the cd (change directory) command to navigate to the simulation directory (e.g. the Kinneret97 folder) In Finder, go to the macGLM folder and right-click on the glm app, select Show Package Contents Enter the Contents folder then the MacOS folder, and locate the glm executable file Back in terminal, enter the file path for this executable file - you can do this by dragging/dropping the file into the terminal Leave a space after the file path and type --xdisp Press Enter and the model will run These steps are shown in the screen recording below for the Kinneret97 simulation: Your Mac may block opening GLM the first time you run it. If this occurs, go to your Security options inside System Preferences and click ‘Open Anyway’. Running GLM on Windows On Windows, the model can be run using a batch-file glm.bat, which you can open from in the simulation directory (e.g. Kinneret97 folder). The .bat file calls the GLM model from the current working directory. If the model is not opening make sure you’re not working in a network directory (e.g. OneDrive) and the file path to the glm.bat file has zero spaces in it. "],["processing-outputs.html", "Processing Outputs", " Processing Outputs "],["error-assessment.html", "Error Assessment Mean Absolute Error (MAE) Sensitivity Index (SI)", " Error Assessment Mean Absolute Error (MAE) Mean absolute error measures the average absolute difference between the simulated and the observed results. It is calculated by summing the absolute error between paired values (i.e. modeled and actual) and dividing by the number of observations: \\[\\begin{equation} MAE = \\frac{\\sum_{i}\\left | T_{i}^{sim}-T_{i}^{obs} \\right |}{n} \\tag{1} \\end{equation}\\] Sensitivity Index (SI) Calculating a sensitivity index allows the impact of changing an independent variable to be assessed on a dependent variable. Given all other variables are held constant, the SI is computed by dividing the percentage change in the simulated result (i.e. the output) by the percentage change of the input parameter: \\[\\begin{equation} SI = \\frac{(Output_{new}-Output_{original})/Output_{original}}{(Parameter_{new}-Parameter_{original})/Parameter_{original}} \\tag{2} \\end{equation}\\] "],["kinneret-sim.html", "Case Study: Kinneret About Exercises Error Assessment", " Case Study: Kinneret About Lake Kinneret is a freshwater lake (32 ºN, 35 ºE) situated in northern Israel, and is the lowest freshwater lake in the world (209m below Mediterranean Sea Level). The lake has a surface area of 173 km2, and is about 49 m deep. The model is set-up to simulate the hydrological domain of Lake Kinneret for 2 years, from 1997-01-01 to 1999-01-01 (&amp;time), with water balance and heat fluxes hypothetically calculated based on the lake configuration and input data. Water quality functionality (AED2) is disabled for the simulation (&amp;wq_setup). The Kinneret97 model simulation above has the ecological model aed2 enabled. It has been pre-configured to run the customizable AED modules. These are separate models, but have been set up to run side by side. They are configured using the text file aed2.nml. Exercises Begin by running the model as-is. If you’re not sure how to do this, read the Getting Started page. This simulation was only plotting temperature and salinity and these plots were configured in plots.nml. Open plots.nml to see how you can customise the graphs. There are many other variables we may be interested in plotting when we run the watter quality model such as oxygen, nutrients, and algae. A pre-configured file called plots_aed2.nml has been created. To use this file, rename it to plots.nml (you’ll first need to rename the existing plots.nml) and run the model. You should now see more outputs for the lake simulation. In plots.nml the required variables are all listed, make sure the number of plots is high enough to include them all. Table 1: Water quality variables and their descriptions. Description Variable Name Passive tracer TRC_tr1 Water age TRC_age Suspended solids NCS_ss1 Dissolved oxygen OXY_oxy Dissolved inorganic carbon CAR_dic pH CAR_pH Methane (dissolved) CAR_ch4 Methane (bubbles) CAR_ch4_bub Reactive Silica SIL_rsi Ammonium NIT_amm Nitrate/Nitrite NIT_nit Phosphate PHS_frp Particulate inorganic phosphorus PHS_frp_ads Dissolved organic carbon OGM_doc Particualte organic carbon OGM_poc Dissolved organic nitrogen OGM_don Particulate organic nitrogen OGM_pon Dissolved organic phosphorus OGM_dop Particulate organic phsophorus OGM_pop Green algae PHY_green Green algae PHY_green_IN Green algae PHY_green_IP Diatoms PHY_diatom Diatoms PHY_diatom_IN Diatoms PHY_diatom_IP Cyrptophytes PHY_crypto Cyrptophytes PHY_crypto_IN Cyrptophytes PHY_crypto_IP Zooplankton ZOO_zoo01 Let’s also now add water quality variables to the specific depth output files (i.e. WQ_5.csv). To do so we must edit the output section of the glm3.nml file, by adding the variables as extra columns to the .csv file that were configured above. If they are there already, make sure that the number of variables is high enough to include them all. ol > li > ol > li {list-style-type:lower-alpha} As an example to output water quality variables, let’s plot all the nitrogen variables. Change csv_point_vars to include NIT_amm, NIT_nit, OGM_don, OGM_pon, PHY_green_IN - these are all the variables that contribute to the total nitrogen (TN) pool. Now re-run the model (e.g. Windows users double clicking glm.bat again). Once it’s run open WQ_35.csv to see these new variables and create a stacked area plot to show how the different variables contribute to TN. Create a well formatted, interesting graph of variables of your choice (for example, you may like to consider all of the phytoplankton groups or create sums of these to generate a NPZD model) to see how they interact and change over time. If any variables are much bigger or smaller than the others, then use two y-axes or multiple plots. How would these concentrations change if the air temperature increased by 2°C? (You will need to edit the met_hourly.csv file). Make sure to save with correct date format, taking note these met measurements are recorded hourly, so YYYY-MM-DD hh:mm. A pre-made version of this file can be found in bcs which is called met_1997_2004_airT2.csv. To use this file, update meteo_fl = 'bcs/met_1997_2004.csv' in the &amp;meteorology section of glm3.nml. .codeScroll { overflow-y: scroll; height:450px; } !------------------------------------------------------------------------------- ! meteorology !------------------------------------------------------------------------------- &amp;meteorology met_sw = .true. lw_type = &#39;LW_IN&#39; rain_sw = .false. atm_stab = 0 fetch_mode = 0 !rad_mode = 1 albedo_mode = 1 cloud_mode = 4 !-- BC file details subdaily = .true. meteo_fl = &#39;bcs/met_1997_2004.csv&#39; !&lt;------- Update this wind_factor = 0.9 lw_factor = 1.0 lw_offset = 0.0 !-- Parameters ce = 0.0013 ch = 0.0013 cd = 0.0013 !catchrain = .true. !rain_threshold = 0.001 !runoff_coef = 0.0 / What happens if we change the water clarity? Increase and decrease from the original value to see the response You must change the light extinction coefficient Kw (range 0-1) in the glm3.nml file. Error Assessment Calculate the mean absolute error in the simulation using the observed temperature data (ObservedTempData.xlsx from the data folder in Kinneret97) and the simulated temperature data (the simulated temperature data is from the surface layer in lake.csv). ol > li > ol > li {list-style-type:lower-alpha} Calculate the sensitivity of the modelled temperature to changes in water clarity (the light extinction coefficient, \\(K_w\\)) and wind speed (wind_factor). These can be found in glm3.nml. Try increasing and decreasing the default parameter value by 0.2 and see how much the output changes. Assess how sensitive the temperature and phytoplankton biomass is to water clarity: GLM results Water clarity Decrease 0.37 Water clarity Original 0.57 Water clarity Increase 0.77 Average WQ_35 temperature Average WQ_35 phytoplankton (green, crypto, diatom) biomass Assess how sensitive the temperature and phytoplankton biomass is to wind speed: GLM results Wind Speed Decrease 0.6 Wind Speed Original 0.9 Wind Speed Increase 1.2 Average WQ_35 temperature Average WQ_35 phytoplankton (green, crypto, diatom) biomass "],["darwin-sim.html", "Case Study: Darwin", " Case Study: Darwin "],["other-sims.html", "Other Simulations", " Other Simulations "],["references.html", "References", " References "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]

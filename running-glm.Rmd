# Running GLM {#running-glm -}

### Simulation workflow {#C02_4 -}

<center>

```{r picrun-1, echo=FALSE, fig.cap="", out.width = '100%'}
# knitr::include_graphics("images/01-gettingstarted/workflow.png")
knitr::include_graphics("images/02-files/GLMworkbook-15.png")
```

</center>

#### Running GLM on MacOS {#C02_4 -}

- Open the Terminal application on your Mac
- Use the `cd` (change directory) command to navigate to the simulation directory (e.g. the *WarmLake* folder)
- In Finder, go to the `GLM/mac` folder and right-click on the glm app, select *Show Package Contents*
- Enter the Contents folder then the MacOS folder, and locate the glm executable file
- Back in terminal, enter the file path for this executable file - you can do this by dragging/dropping the file into the terminal
- Leave a space after the file path and type `--xdisp`
- Press `Enter` and the model will run

These steps are shown in the screen recording below for an example simulation:

<center>
<video width="100%" height="100%" controls>
  <source src="images/09-module8/video1.mp4" type="video/mp4">
</video>
</center>

```{block2, hint03_1, type='rmdnote2'}
Your Mac may block opening GLM the first time you run it. If this occurs, go to your Security options inside System Preferences and click 'Open Anyway'.
```

<br>

#### Running GLM on Windows {#C02_5 -}

On Windows, the model can be run using a batch-file `glm.bat`, which you can open from in the simulation directory (e.g. *Kinneret97* folder). The `.bat` file calls the GLM model from the current working directory, and should be located where the `glm.nml' file is.


``` {fortran, eval = FALSE, style="max-height: 239px;"}
..\GLM\win\glm_3.3.0\glm.exe --xdisp
echo press any key
pause
```


```{block2, hint03_2, type='rmdnote2'}

If the model is not opening make sure that you are **not** working from a network directory (e.g. OneDrive) and the file path to the `glm.bat` file has **zero** spaces in it.

```



<br>

#### Running and editing GLM with Visual Studio Code {#C02_5 -}

Visual Studio Code is a convenient tool for editing and running GLM in an integrated environment. To work with Visual Studio Code:

- Download VSC from the website https://code.visualstudio.com/ 
- Install VSC onto your computer
- Open the GLM case study folder (e.g. TropicalReservoir) by clicking `File` --> `Open Folder`  
- Open the `glm3.nml` by clicking the file name on the left file list panel, for viewing and editing the GLM configuration file
- If you are using Windows, open the glm.bat file batch-file, click the *Run* symbol (see figure below) to run GLM 
- If you are using Mac, open a termial (by cliking `Terminal` --> `New Terminal`), then enter your commend in the terminal window to run GLM 
- You can now edit the glm3.nml file to change your configurations and run GLM in a same environment to see the changes 


<center>

```{r picrun-2, echo=FALSE, fig.cap="", out.width = '100%'}

knitr::include_graphics("images/01-gettingstarted/Visual_Studio_Code.PNG")
```

</center>


```{block2, hint03_3, type='rmdnote2'}

If you are new to Visual Studio Code and the software is being run for the first time, you would need to install the following extensions:

- *NewGRF Meta Language* extension for better visualising and editing nml files;
- *Batch Runner* extenstion to run the batch file 


```



<br>

### Visualising Results {-}

Depending on your preference for visualisation software, both Excel and R can be used for the plotting of GLM's general lake or depth-specific csv outputs. R is required for visualising NetCDF outputs. 

### Excel {-}

```{r pic04-1, echo=FALSE, fig.cap="", out.width = '100%'}
knitr::include_graphics("images/processing-outputs/picture1.png")
```

### R {-}

```{r echo=TRUE, message=FALSE, warning=FALSE}
# Load packages
library(tidyverse) 
library(lubridate)

read_csv("plots/processing-outputs/WQ_5.csv") %>%  # Read GLM csv
  mutate(
    time = as_datetime(time, format = "%Y-%m-%d %H:%M:%S") # Format date/time
  ) %>% 
  ggplot(mapping = aes(x = time, y = temp)) + # Plot with ggplot()
  geom_line(colour = 'red') +
  labs(x = "Date", y = "Temperature (Â°C)") +
  theme_classic()
  
```

